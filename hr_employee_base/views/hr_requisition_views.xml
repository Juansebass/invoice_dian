<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_hr_requisition_form" model="ir.ui.view">
            <field name="name">view.hr.requisition.form</field>
            <field name="model">hr.requisition</field>
            <field name="arch" type="xml">
                <form string="Requisiciones">
                    <header>
                        <field name="stage_id" widget="statusbar"/>
                        <button type="object" string="Confirmar" class="oe_highlight" name="button_approved" attrs="{'invisible': [('recruitment_stage_type', '=', 'application')]}"/>
                        <button type="object" string="Rechazar" class="btn btn-danger" name="button_rejected" attrs="{'invisible': [('recruitment_stage_type', '=', 'rejection')]}"/>
                      
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button" type="object" name="action_view_applicant"
                                    icon="fa-pencil-square-o">
                                <field name="applicant_count" widget="statinfo" string="Aplicantes"/>
                            </button>
                        </div>
                        <widget name="web_ribbon" text="Rechazada" bg_color="bg-danger"
                                attrs="{'invisible': [('recruitment_stage_type', '!=', 'rejection')]}"/>
                        <widget name="web_ribbon" text="Finalizada" bg_color="bg-success"
                                attrs="{'invisible': [('recruitment_stage_type', '!=', 'application')]}"/>
                        <div class="oe_title">
                            <h1>
                                <field name="name" string="Referencia de la Requisición"
                                       placeholder="Referencia de la Requisición" readonly="True"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="requesting_employee" string="Solicitante"
                                       options="{'no_create': True}"/>
                                <field name="requesting_employee_job" string="Cargo del solicitante"/>
                            </group>
                            <group>                                
                                <field name="company_id" string="Empresa Cliente" groups="base.group_multi_company" readonly="False"
                                       options="{'no_open': True, 'no_create': True}"/>                                
                                <field name="priority" string="Prioridad" widget="priority"/>
                                <field name="opening_date" string="Fecha de Apertura"/>
                                <field name="approve_date" string="Fecha de Aprobación" attrs="{'invisible': [('recruitment_stage_type', '!=', 'application')]}"/>
                                <field name="reject_date" string="Fecha de Rechazo" attrs="{'invisible': [('recruitment_stage_type', '!=', 'rejection')]}"/>
                                <field name="no_of_hired_employee" readonly="True"/>
                                <field name="recruitment_stage_type" invisible="True"/>

                            </group>
                        </group>
                        <group string="Aprobaciones">
                            <field name="approval_ids" string="Formación Académica" nolabel="1">
                                <tree editable="bottom" >
                                    <field name="stage_id" string="Etapa" required="True"/>
                                    <field name="approver_id" string="Aprobador/Responsable" required="True"/>
                                    <field name="response_date" string="Fecha Respuesta" readonly="1"/>
                                    <field name="state" string="Estado" readonly="1"/>
                                </tree>
                                <form>
                                    <field name="stage_id" string="Etapa" required="True"/>
                                    <field name="approver_id" string="Aprobador" required="True"/>
                                </form>
                            </field>
                        </group>
                        <field name="state" invisible="True"/>
                        <notebook>
                            <page string="Información de la Vacante">
                                <group>
                                    <group>
                                        <field name="immediate_boss_id" string="Jefe Inmediato" required="True"
                                               options="{'no_open': True, 'no_create': True}"/>
                                        <field name="job_id" string="Cargo Solicitado" required="True"
                                               options="{'no_open': True, 'no_create': True}"/>

                                        <field name="primary_education_level"/>
                                        <field name="advanced_education_level"/>
                                        <field name="job_role_id" domain="[('job_id','=',job_id)]"/>
                                        <field name="skill_ids" widget="many2many_tags"/>

                                        <field name="vacancies_qty" string="Cantidad de Vacantes" required="True"/>
                                        <field name="gender" string="Genero" required="True"/>
                                        <field name="city_id" string="Ciudad" required="True" options="{'no_open': True, 'no_create': True}"/>                                      
                                        <field name="sede" string="Sede" required="True"/>
                                        <field name="area" string="Área" required="True"/>
                                        <field name="organizational_unit_id" string="Cliente/Proyecto o Unidad Organizativa"
                                               required="True"/>
                                        <field name="cost_center_id" string="Centro de Costo" required="True"/>
                                    
                                       
                                    </group>
                                    <group>
                                        <field name="in_charge_of_personnel" string="Tiene Personal a Cargo" required="True"/>
                                        <field name="interview_required"
                                               string="Requiere Entrevista con Jefe Inmediato" required="True"/>
                                        <field name="test_required" string="Requiere Prueba Técnica" required="True"/>
                                        <field name="security_check_required" string="Requiere Estudio de Seguridad"
                                               required="True"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Contrato">
                                <group>
                                    <group>
                                        <field name="work_shift_id" string="Turno" required="True" options="{'no_open': True, 'no_create': True}"/>
                                        <field name="resource_calendar_id" string="Horario de Trabajo" required="True"/>
                                        <field name="risk_type_id" string="Riesgo ARL" required="True"
                                               options="{'no_create': True}"/>
                                        <!-- <field name="arl_risk_level" string="Nivel de Riesgo ARL" required="True"/> -->
                                        <field name="arl_risk" string="Porcentaje Nivel de Riesgo ARL"/>                                       
                                        <!-- <field name="vacation_handling" string="HSorario / Manejo de Vacaciones" required="True"/> -->
                                        <field name="disability_handling_id" string="Manejo de Incapacidades Generales"
                                               required="True" options="{'no_open': True, 'no_create': True}"/>
                                    </group>
                                    <group>
                                        <field name="contract_type_id" string="Tipo de Contrato" required="True"
                                               options="{'no_open': True, 'no_create': True}"/>
                                        <field name="initial_contract_time" string="Tiempo de Contrato Inical"/>
                                        <field name="contract_time_range"  string="Rango"/>
                                        <field name="client" groups="hr.group_hr_user"/>
                                        <field name="contract_number" groups="hr.group_hr_user"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Justificación">
                                <group>
                                    <group>
                                        <field name="req_motive_id" 
                                               string="Motivo de Solicitud"
                                               context="{'default_requisition_reason': True}"
                                               options="{'no_open': True, 'no_create': True}"
                                               required="True"/>
                                        <field name="employee_replace" string="Persona a Quien Reemplaza"
                                               options="{'no_open': True, 'no_create': True}"/>
                                        <field name="budgeted_job" string="Cargo Presupuestado" required="True"/>
                                    </group>
                                    <group>
                                        <field name="salary_type" string="Tipo de Salario" required="True"/>
                                        <label for="wage" string="Salario"/>
                                        <div class="o_row no-gutters d-flex">
                                            <field name="wage" string="Salario" required="True" readonly="False"/>
                                            <span> - </span>
                                            <field name="wage_max" string="Salario" readonly="False"/>
                                        </div>
                                        <field name="agreement" string="Pacto/Convención" required="True"/>                                    

                                        <field name="referral_document" string="Documento Referido"/>
                                    </group>
                                    <group string="Beneficios">
                                        <field name="food_allowance" string="Auxilio de Alimentación Fijo"
                                            />
                                        <field name="food_allowance_value"
                                               attrs="{'invisible': [('food_allowance', '!=', True)], 'required': [('food_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="food_allowance_start"
                                               attrs="{'invisible': [('food_allowance', '!=', True)], 'required': [('food_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="food_allowance_proportional" string="Auxilio de Alimentación Proporcional"
                                            />
                                        <field name="food_allowance_proportional_value"
                                               string="Valor Auxilio de Alimentación Proporcional"
                                               attrs="{'invisible': [('food_allowance_proportional', '!=', True)], 'required': [('food_allowance_proportional', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="food_allowance_proportional_start"
                                               attrs="{'invisible': [('food_allowance_proportional', '!=', True)], 'required': [('food_allowance_proportional', '=', True)]}"
                                               groups="hr.group_hr_user"
                                               string="Auxilio de Alimentación proporcional a partir de"/>
                                        <field name="transport_allowance" string="Auxilio de Rodamiento Fijo"
                                            />
                                        <field name="transport_allowance_value" string="Valor Auxilio de Rodamiento"
                                               attrs="{'invisible': [('transport_allowance', '!=', True)], 'required': [('transport_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="transport_allowance_start"
                                               attrs="{'invisible': [('transport_allowance', '!=', True)], 'required': [('transport_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="transport_allowance_proportional" string="Auxilio de Rodamiento Proporcional"
                                            />
                                        <field name="transport_allowance_proportional_value"
                                               attrs="{'invisible': [('transport_allowance_proportional', '!=', True)], 'required': [('transport_allowance_proportional', '=', True)]}"
                                               groups="hr.group_hr_user"
                                               string="Valor Auxilio de Rodamiento Proporcional"/>
                                        <field name="transport_allowance_proportional_start"
                                               attrs="{'invisible': [('transport_allowance_proportional', '!=', True)], 'required': [('transport_allowance_proportional', '=', True)]}"
                                               groups="hr.group_hr_user"
                                               string="Auxilio de Rodamiento Proporcional a Partir de"/>
                                        <field name="cellphone_allowance"/>
                                        <field name="cellphone_allowance_value"
                                               attrs="{'invisible': [('cellphone_allowance', '!=', True)], 'required': [('cellphone_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="cellphone_allowance_start"
                                               attrs="{'invisible': [('cellphone_allowance', '!=', True)], 'required': [('cellphone_allowance', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="mobilization_allowance" string="Auxilio de Movilización"
                                            />
                                        <field name="mobilization_allowance_value"
                                               attrs="{'invisible': [('mobilization_allowance', '!=', True)], 'required': [('mobilization_allowance', '=', True)]}"
                                               groups="hr.group_hr_user" string="Valor Auxilio de Movilización"
                                            />
                                        <field name="mobilization_allowance_start"
                                               attrs="{'invisible': [('mobilization_allowance', '!=', True)], 'required': [('mobilization_allowance', '=', True)]}"
                                               groups="hr.group_hr_user" string="Auxilio de Movilización a Partir de"/>
                                    </group>
                                    <group>
                                        <field name="prepaid_medicine" string="Medicina Prepagada"/>
                                        <field name="prepaid_medicine_value"
                                               attrs="{'invisible': [('prepaid_medicine', '!=', True)], 'required': [('prepaid_medicine', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="prepaid_medicine_start"
                                               attrs="{'invisible': [('prepaid_medicine', '!=', True)], 'required': [('prepaid_medicine', '=', True)]}"
                                               groups="hr.group_hr_user" string="Medicina Prepagada a partir de"/>
                                        <field name="bonos"/>
                                        <field name="bono_value"   attrs="{'invisible': [('bonos', '!=', True)], 'required': [('bonos', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="bonos_start"
                                               attrs="{'invisible': [('bonos', '!=', True)], 'required': [('bonos', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="commission"/>
                                        <field name="commission_value"    attrs="{'invisible': [('commission', '!=', True)], 'required': [('commission', '=', True)]}"  groups="hr.group_hr_user"/>
                                        <field name="commission_start"
                                               attrs="{'invisible': [('commission', '!=', True)], 'required': [('commission', '=', True)]}"
                                               groups="hr.group_hr_user"/>
                                        <field name="other_benefit" groups="hr.group_hr_user"/>
                                        <field name="other_benefit_value" attrs="{'invisible': ['|',('other_benefit', '=', False),('other_benefit', '=', '')], 'required': [('other_benefit', '!=', False)]}"  groups="hr.group_hr_user" string="Valor otro Beneficio"/>
                                        <field name="other_benefit_start"
                                               attrs="{'invisible': ['|',('other_benefit', '=', False),('other_benefit', '=', '')], 'required': [('other_benefit', '!=', False)]}"
                                               groups="hr.group_hr_user" string="Otro Beneficio a partir de"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Asignación">
                                <group>
                                    <group>
                                        <field name="job_type_id" string="Tipo de Cargo" options="{'no_open': True, 'no_create': True}"/>
                                        <field name="req_therapist" options="{'no_open': True, 'no_create': True}"  domain="[('is_recruitment_leader','=',True)]"/>
                                        <field name="req_recruiter" options="{'no_open': True, 'no_create': True}"/>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                        <group>
                            <field name="observations" string="Observaciones"/>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>                        
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="view_hr_requisition_tree" model="ir.ui.view">
            <field name="name">view.hr.requisition.tree</field>
            <field name="model">hr.requisition</field>
            <field name="arch" type="xml">
                <tree string="sector customer">
                    <field name="name" string="Requisición"/>
                    <field name="job_id"/>
                    <field name="req_therapist"/>
                    <field name="req_recruiter"/>
                    <field name="vacancies_qty" sum="vacancies_qty"/>
                    <field name="no_of_hired_employee" sum="Total" />
                    <field name="company_id"/>
                    <field name="state" string="Estado de la Requisición"/>
                </tree>
            </field>
        </record>

        <record id="view_hr_requisition_pivot" model="ir.ui.view">
            <field name="name">view.hr.requisition.pivot</field>
            <field name="model">hr.requisition</field>
            <field name="arch" type="xml">
                <pivot string="Vista Pivot Requisiciones">
                    <field name="name" string="Requisición"/>
                    <field name="state" string="Estado de la Requisición"/>
                </pivot>
            </field>
        </record>

        <record id="view_hr_requisition_search" model="ir.ui.view">
            <field name="name">view.hr.requisition.search</field>
            <field name="model">hr.requisition</field>
            <field name="arch" type="xml">
               <search>
                   <field name="requesting_employee_job"/>
                  
               </search>
            </field>
        </record>

        <record id="action_hr_requisition" model="ir.actions.act_window">
            <field name="name">Requisiciones</field>
            <field name="res_model">hr.requisition</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_mode">kanban,tree,form,pivot,search</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Requisiciones
                </p>
            </field>
        </record>

        <record id="seq_requisiciones" model="ir.sequence">
            <field name="name">requisiciones</field>
            <field name="code">requisiciones</field>
            <field name="prefix">RQ%(year)s</field>
            <field name="padding">4</field>
            <field name="company_id" eval="False"/>
        </record>

        <record model="ir.ui.view" id="view_openacad_session_kanban">
            <field name="name">view.hr.requisition.kanban</field>
            <field name="model">hr.requisition</field>
            <field name="arch" type="xml">
                <kanban default_group_by="stage_id" quick_create_view="hr_employee_base.view_hr_requisition_form" records_draggable="false">
                    <field name="name"/>
                    <field name="color"/>                   
                    <progressbar field="activity_state" colors='{"planned": "success", "today": "warning", "overdue": "danger"}' sum="cantidad_vacantes" help="This bar allows to filter the opportunities based on scheduled activities." />
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click">
                                <div class="oe_Kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title"><field name="name"/></strong>
                                        </div>    
                                        <div class="o_dropdown_kanban dropdown" t-if="!selection_mode" groups="base.group_user">
                                            <!-- dropdown menu -->
                                            <a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                                                <span class="fa fa-ellipsis-v"/>
                                            </a>
                                            <div class="dropdown-menu" role="menu">
                                                <a t-if="widget.editable" role="menuitem" type="edit" class="dropdown-item">Edit</a>
                                                <t t-if="widget.deletable"><a type="delete" class="dropdown-item" role="menuitem">Delete</a></t>
                                                <ul class="oe_kanban_colorpicker" data-field="color"/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <!-- title -->
                                        <!-- <strong>Requisición:<field name="name"/></strong><br/> -->
                                        <strong>Cantidad de Vacantes:<field name="vacancies_qty"/></strong><br/>
                                        <field name="job_id"/><br/>
                                        <field name="company_id"/><br/>
                                        <!-- <field name="priority" widget="priority"/>
                                        <field name="activity_ids" widget="kanban_activity"/> -->
                                    </div>
                                    <div class="o_kanban_record_bottom" t-if="!selection_mode">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="priority" widget="priority"/>
                                            <field name="activity_ids" widget="kanban_activity"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="oe_clear"/>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
               

        <menuitem name='Requisiciones'
                  action='action_hr_requisition'
                  id='hr_requisition_menu'
                  parent='hr_recruitment.menu_hr_recruitment_root'
                  sequence='3'/>

    <!-- Stage Tree View -->
    <record model="ir.ui.view" id="hr_requisition_stage_tree">
        <field name="name">hr.requisition.stage.tree</field>
        <field name="model">hr.requisition.stage</field>
        <field name="arch" type="xml">
            <tree string="Etapas requisición" editable="bottom">
                <field name="sequence" widget="handle"/>
                <field name="name" required="1"/>
                <field name="approver_id"/>
                <field name="stage_type" required="1"/>
            </tree>
        </field>
    </record>

    <!-- Stage Action -->
    <record id="hr_requisition_stage_act" model="ir.actions.act_window">
        <field name="name">Etapas requisición</field>
        <field name="res_model">hr.requisition.stage</field>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="hr_requisition_stage_tree"/>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Add a new stage in the requisition process
          </p>
        </field>
    </record>

    <!-- Stage Menu -->
    <menuitem
        id="menu_hr_requisition_stage"
        name="Etapas requisición"
        parent='hr_recruitment.menu_hr_recruitment_configuration'
        action="hr_requisition_stage_act"
        groups="base.group_no_one"
        sequence="2"/>

    </data>
</odoo>
